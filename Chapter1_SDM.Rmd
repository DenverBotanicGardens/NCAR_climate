---
title: "R Notebook"
output: html_notebook
---

I think the outputs that don't have _EOR or _herb are the ones that used Herb to train and EOR to test. can see what the AUC patterns were for those. 
Making new herb train and EOR test ones with VisTrails and same size EOR numbers
```{r}
# pathstart <- "Q:/Research/Projects/alpine-phenology/Uncertainty in niche modeling/RMaxEnt/Arabis crandallii_EOR/"
# 
# resultpath <- list.files(path = pathstart, pattern = "maxentResults.csv") # , full.names = TRUE)[[1]]

maxouts <- list.dirs(path = "Q:/Research/Projects/alpine-phenology/Uncertainty in niche modeling/RMaxEnt",full.names = TRUE, recursive = TRUE)

maxoutsubset <- maxouts[!grepl("plots", maxouts)]
maxoutsubset <- maxoutsubset[!grepl("_EOR", maxoutsubset)]
maxoutsubset <- maxoutsubset[!grepl("_herb", maxoutsubset)]

sapply(strsplit(maxoutsubset,"/"), function(x){
  x[7]
})

# Where is the information about EOR size and distances to match to the names? 


AUCresults <- do.call(rbind,lapply(maxoutsubset, function(x){
  read.csv(paste(x,"/maxentResults.csv", sep=""))
}))

names(AUCresults)[grep("AUC",names(AUCresults))]

hist(AUCresults$Training.AUC)
```

Get all the files that I'm making with VisTrails, then extract the information from the sets I want. Named similar runs the same way. 
```{r}
maxouts2 <- list.dirs(path = "Q:/Research/Projects/alpine-phenology/Uncertainty in niche modeling/VisTrails/EORvHERB_2019/EORvHERB_2019",full.names = TRUE, recursive = TRUE)


#EORsamesize matches _Sp with the same number
# These all have k-fold of 5 so keeping out 20% each time to test but for some, too few points, so should compare to subsampling with replacement/bootstrapping 
EORsame <- maxouts2[grepl("_EORsamesize", maxouts2)]
speciesEOR <- unique(unlist(lapply(regmatches(EORsame, gregexpr("[[:digit:]]+", EORsame)),"[[", 3)))

# Must be an easier way but only want the first folder, don't want to dig in any deeper
EORsamesub <- EORsame[!grepl("Merged", EORsame)]
EORsamesub <- EORsamesub[!grepl("plots", EORsamesub)]
EORsamesub <- EORsamesub[!grepl("cvSplit", EORsamesub)]
EORsamesub <- EORsamesub[!grepl("Expanded", EORsamesub)]
EORsamesub <- EORsamesub[!grepl("responseCurves", EORsamesub)]

# The 9th layer is the folder for that Maxent output
unique(sapply(strsplit(EORsame,"/"), function(x){
  x[9]
}))

# Which species number is each? 
unique(sapply(strsplit(EORsame,"Sp"), function(x){
  as.numeric(gsub("([0-9]+).*$", "\\1", x[2]))
}))

# Split at the Sp, take that second string that starts with the species number and extract the first number
sapply(strsplit(EORsamesub, "Sp"), function(x){
  as.numeric(gsub("([0-9]+).*$", "\\1", x[2]))
})

x <- EORsamesub[[1]]
# Where is the information about EOR size and distances to match to the names? 

AUCresults2 <- do.call(rbind,lapply(EORsamesub, function(x){
  resultfile <- read.csv(paste(x,"/maxentResults.csv", sep=""))
  resultfile$Species <- as.numeric(resultfile$Species)
  y <- strsplit(x,"Sp")
  resultfile$Species <- as.numeric(gsub("([0-9]+).*$", "\\1", y[[1]][2]))
  resultfile
}))

hist(AUCresults2$Training.AUC)

# Compare to the Herb results
Herbsame <- maxouts2[grepl("Maxent_Sp", maxouts2)]
speciesHerb <- unique(unlist(lapply(regmatches(EORsame, gregexpr("[[:digit:]]+", EORsame)),"[[", 3)))
match(speciesHerb,speciesEOR)

# Must be an easier way but only want the first folder, don't want to dig in any deeper
Herbsamesub <- Herbsame[!grepl("Merged", Herbsame)]
Herbsamesub <- Herbsamesub[!grepl("plots", Herbsamesub)]
Herbsamesub <- Herbsamesub[!grepl("cvSplit", Herbsamesub)]
Herbsamesub <- Herbsamesub[!grepl("Expanded", Herbsamesub)]
Herbsamesub <- Herbsamesub[!grepl("responseCurves", Herbsamesub)]


read.csv(paste(Herbsamesub[[5]],"/maxentResults.csv", sep=""))

AUClist <- lapply(Herbsamesub, function(x){
  read.csv(paste(x,"/maxentResults.csv", sep=""))
})

# don't want 5, 7, 10
AUCresults3 <- do.call(rbind,lapply(c(1:4,6,8:9,11:14), function(x){
  AUClist[[x]]
}))


# AUCresults3 <- do.call(rbind,lapply(Herbsamesub, function(x){
#   read.csv(paste(x,"/maxentResults.csv", sep=""))
# }))

hist(AUCresults3$Training.AUC)


# TestEOR_ only want one per species, manually go in and delete extras that had mishaps

```

# Rounds of VisTrails with elevation: coplus50int; aspect: aspect50int; ruggedness: COplus_ruggedInt50; annual temp Bio1 and annual precip Bio12 

Name the EOR ones as EORSp1... and compare   
<https://gis.stackexchange.com/questions/29118/how-to-find-the-average-raster-value-of-an-area-defined-by-a-shapefile-using-r> 
```{r}
dirs.vistrails <- list.dirs(path = "Q:/Research/Projects/alpine-phenology/Uncertainty in niche modeling/VisTrails/EORvHERB_2019/EORvHERB_2019",full.names = TRUE, recursive = TRUE) 

dirs.vistrails[grep("_Sp",dirs.vistrails)]


```


```{r}
load("Q:/Research/Projects/alpine-phenology/Uncertainty in niche modeling/Data/pca_data.Rda")

linkspeciesnumber <- do.call(rbind,lapply(1:length(pca_data), function(x){
  data.frame(SpNum = x, Species = unique(pca_data[[x]]$GNAME[pca_data[[x]]$pa==3]),
             Dist = pca_data[[x]]$dist[pca_data[[x]]$pa==2], # pa==2 are herb
             SpeciesArea = unique(pca_data[[x]]$area[pca_data[[x]]$pa==1]))
}))



```


Want to add vegetation types, layer too. should work now that I've got all the other layers a better size

Make maxent commands
for output prediction map, use ENMeval   
```{r}


```

